{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block breadcrumbs %}{% endblock %}

{% block content %}

<H1>Asignar {{ tipo|title }}</H1>
<form method="get" action="{% url 'lista_encuentros' %}" class="d-flex" id="filtroForm">
    <div class="form-group mr-2">
        <label for="competicion">Competición</label>
        <select name="competicion" id="competicion" class="form-control filtro">
            <option value="">Todas</option>
            {% for competicion in competiciones %}
                <option value="{{ competicion.id }}" {% if selected_competicion == competicion.id %}selected{% endif %}>{{ competicion.nombre }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group mr-2">
        <label for="fase">Fase</label>
        <select name="fase" id="fase" class="form-control filtro">
            <option value="">Todas</option>
            {% for fase in fases %}
                <option value="{{ fase.id }}" {% if selected_fase == fase.id %}selected{% endif %}>{{ fase.nombre }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group mr-2">
        <label for="grupo">Grupo</label>
        <select name="grupo" id="grupo" class="form-control filtro">
            <option value="">Todos</option>
            {% for grupo in grupos %}
                <option value="{{ grupo.id }}" {% if selected_grupo == grupo.id %}selected{% endif %}>{{ grupo.nombre }}</option>
            {% endfor %}
        </select>
    </div>
</form>

{% csrf_token %}
<div class="table-responsive">
    <table class="table table-bordered table-hover">
        <thead class="thead-dark">
            <tr>
                <th>Competición</th>
                <th>Fase</th>
                <th>Grupo</th>
                <th>Equipo Local</th>
                <th>Equipo Visita</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for encuentro in encuentros %}
            <tr>
                <td>{{ encuentro.competicion_id.nombre }}</td>
                <td>{{ encuentro.fase.nombre }}</td>
                <td>{{ encuentro.grupo.nombre }}</td>
                <td>{{ encuentro.equipo_local.nombre }}</td>
                <td>{{ encuentro.equipo_visita.nombre }}</td>
                <td>
                    <a href="{% url 'asignar' tipo=tipo encuentro_id=encuentro.encuentro_id %}" class="btn btn-primary">
                        Asignar
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    // Agregar un evento change a todos los elementos con la clase 'filtro'
    document.querySelectorAll('.filtro').forEach(function (element) {
        element.addEventListener('change', function () {
            document.getElementById('filtroForm').submit(); // Enviar el formulario al cambiar
        });
    });
</script>

{% endblock %}
