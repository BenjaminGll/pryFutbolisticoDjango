{% extends 'base.html' %}
{% load i18n static %}
{% block title %} TV en Vivo - Partido de Fútbol {% endblock %}
{% block content %}
<style>
  .fondo {
    width: 100%;
    /* Hace que el fondo ocupe el 100% del ancho del contenedor */
    height: 100%;
    /* Hace que el fondo ocupe el 100% de la altura de la ventana */
    background-size: cover;
    /* Escala la imagen de fondo para cubrir todo el elemento */
    background-position: center;
    /* Centra la imagen de fondo horizontalmente */

  }


  .banners-container {
    position: absolute;
    top: 98%;
    right: 30%;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    text-align: center;
    width: 600px;
    font-size: 20px;
    border-radius: 5px;
    z-index: 1;
  }


  .banner-marcadores {
    position: absolute;
    top: 230px;
    right: 1100px;
    background-color: rgb(210, 210, 210);
    color: black;
    text-align: center;
    height: 30px;
    width: 280px;
    font-size: 16px;
    border-radius: 5px;
    z-index: 1;
  }
</style>
<div class="container">
  <!-- <h1>TV en Vivo - Partido de Fútbol</h1> -->
  <div class="video-container">

    <br>
    <img class="fondo" src="/static/images/fondoFut.jpg" alt="">


    
    <!--   <div class="banner-cronometro">
      <span id="cronometro">00:00</span>
    </div>--> 
    
    <div class="banner-marcadores" id="general" style="display:none">
      <span id="cronometro">00:00</span>&nbsp;<img src="{{jugar_encuentro.equipo_local.sede_id.ciudad_id.pais_id.logo_bandera.url}}" alt="" style="margin-top:0px; width: 13%"><span> {{equipo_a.siglas}} </span><span id="marcador-local">{{goles_equipo_a}}</span> - <span id="marcador-visitante">{{goles_equipo_b}}</span></span><span> {{equipo_b.siglas}} </span><img src="{{jugar_encuentro.equipo_visita.sede_id.ciudad_id.pais_id.logo_bandera.url}}" alt="" style="margin-top:0px; width: 13%">
    </div>
    <div id="banners-container" class="banners-container" style="display: none;">
      <!-- Contenido del banner -->
      <p></p>
    </div>
    <div class="banner-container" style="display: flex;justify-content: center; align-items: center;position: absolute;left:30%;top:60%; background-size: cover;">
      <div class="banner" style="background: rgba(0, 0, 0, 0.7);color: white;border-radius: 5px;font-family: 'Arial', sans-serif; display: flex;width: 500px;">
          <div class="left-side" style="padding: 20px;display: flex;flex-direction: column; align-items: center;background: rgba(0, 0, 0, 0.8);">
              <span class="team-name" style="font-size: 24px;font-weight: bold;background: rgba(0, 0, 0, 0.8);margin-bottom: 10px; width: 100%; text-align: center;">{{equipo_a.siglas}} <!-- Nombre del equipo o siglas--></span>
              <!-- escudo Equipo--><img src="{{equipo_a.logo.url}}" alt="Team Logo" class="team-logo" style="width: 150px;height: auto;margin-bottom: 20px;">
              <div class="formation" style="font-size: 18px;font-weight: bold;background: rgba(0, 0, 0, 0.8);padding: 5px;border-radius: 5px;width: 100%;text-align: center;">{{formacion_a.formacion}}<!-- alineación o formacion--></div>
          </div>
          <div class="middle-side" style="display: flex;align-items: center;background: rgba(50, 50, 50, 0.8);padding: 0 10px;">
              <span class="title" style="font-size: 16px;font-weight: bold;color: white;writing-mode: vertical-lr;transform: rotate(180deg);">TITULARES<!-- creo que esto queda asi--></span>
          </div>
          <div class="right-side" style="padding: 20px;display: flex;flex-direction: column;align-items: flex-start;">
              <div class="player-list" style="display: flex;flex-direction: column;">
                {% for alineacion_a in alineacion_equipo_a %}
                  <div class="player" style="font-size: 16px;line-height: 1.4;text-align: left;"><span class="dorsal" style="font-weight: bold;margin-right: 5px;">{{alineacion_a.dorsal}}<!-- dorsal jugador --></span><span class="name" style="font-weight: normal;">{{alineacion_a}} <!-- Nombre jugador y posición--></span></div>
                {% endfor %}
              </div>
          </div>
      </div>
    </div>
  </div>
  <br>
  <br>
  <br>
  <br>


  <!-- {% for e in eventos %} -->

  <!-- Comprueba si el evento debe mostrar un banner -->
  <!-- {% if e.mostrar_banner %} -->
  <!-- Aquí coloca el código HTML para el banner basado en el evento e -->

  <!-- {% endif %} -->
  <!-- {% endfor %} -->


</div>




<script>
  console.log("Fuera del bucle");
  // ...
  let bannerElement = null;
  function obtenerBanners() {

    fetch('/datostv')


      .then(response => response.json())
      .then(data => {
        const bannersContainer = document.getElementById('banners-container');
        if (bannersContainer) {
          const nuevosBanners = data.banners;

          if (nuevosBanners.length > 0) {
            const banner = nuevosBanners[0];

            if (!bannerElement) {
              bannerElement = document.createElement('div');
              bannerElement.classList.add('banner-container');
              bannersContainer.appendChild(bannerElement);
            }

            bannerElement.innerHTML = banner.html; // Actualizar el HTML del banner actual
            console.log('HTML del banner:', banner.html);
            // Muestra banners-container
            bannersContainer.style.display = 'block';
            //Tiempo para mostrarse
            const tiempoSegundos = banner.tiempo;
            // const tiempoEnMilisegundos = tiempoSegundos*1000;
            const tiempoEnMilisegundos = tiempoSegundos * 1000;
            console.log(tiempoEnMilisegundos)
            // Oculta banners-container después de 10 segundos
            setTimeout(() => {
              bannersContainer.style.display = 'none';
              //   // Limpia el archivo temporal 'eventos_temporales.json'
              fetch('/limpiar-eventos-temporales')
                .then(response => response.json())
                .then(data => {
                  console.log('Archivo temporal limpiado:', data);
                })
                .catch(error => console.error(error));
            }, tiempoEnMilisegundos);
          }
        } else {
          console.error('Elemento con ID "banners-container" no encontrado.');
        }
      })
      .catch(error => console.error(error));
  }

  // obtenerBanners();
  setInterval(obtenerBanners, 2000);

  // document.addEventListener('DOMContentLoaded', function () {
  //   var minutos = 0;
  //   var segundos = 0;
  //   var cronometroDisplay = document.getElementById('cronometro');
  //   var cronometro = setInterval(function () {
  //     segundos++;
  //     if (segundos == 60) {
  //       minutos++;
  //       segundos = 0;
  //     }
  //     cronometroDisplay.innerHTML = (minutos < 10 ? '0' + minutos : minutos) + ':' + (segundos < 10 ? '0' + segundos : segundos);
  //   }, 1000);
  // });




  var minutos = 0;
  var segundos = 0;
  var cronometroDisplay = document.getElementById('cronometro');
  var cronometro;

  let elapsedTime = 0;
  function Cronometro() {

    elapsedTime++;
    const minutes = Math.floor(elapsedTime / 60);
    const seconds = elapsedTime % 60;

    const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;


    cronometroDisplay.innerHTML = formattedTime;
  }

 //cronometro = setInterval(Cronometro, 1000);

  
  var estadoAccion = '';
  function actualizarCronometro() {
    // Realizar la solicitud AJAX para obtener la información del cronómetro
    fetch('/obtener_cronometro/')
      .then(function (response) {
        if (!response.ok) {
          throw new Error('Error en la solicitud AJAX');
        }
        return response.json();
      })
      .then(function (data) {
        var generalDisplay = document.getElementById('general');
        // Verificar la acción y realizar acciones correspondientes
        if (data.accion == 'ocultar') {
          console.log('ocul');
          generalDisplay.style.display = 'none';
        } else if (data.accion == 'mostrar') {
          console.log('mos');
          generalDisplay.style.display = 'inline-block';
        } else if (data.accion == 'pausa' && estadoAccion != 'pausa') {
          console.log('pau');
          clearInterval(cronometro);
        } else if (data.accion == 'play' && estadoAccion != 'play') {
          console.log('play');
            if(data.tiempo){
              const tiempoArray = data.tiempo.split(':');
              const minutos = parseInt(tiempoArray[0],10);
              const segundos = parseInt(tiempoArray[1],10);

              elapsedTime = minutos * 60 + segundos;
            }
          clearInterval(cronometro);  // Detener el intervalo existente antes de configurar uno nuevo
          cronometro = setInterval(Cronometro, 1000);  // Configurar un nuevo intervalo
        }else if (data.accion == 'reset' && estadoAccion != 'reset') {
          console.log('reset');
          var tiemporeset = '00:00';
            if(tiemporeset){
              const tiempoArray = tiemporeset.split(':');
              const minutos = parseInt(tiempoArray[0],10);
              const segundos = parseInt(tiempoArray[1],10);

              elapsedTime = minutos * 60 + segundos;
            }
          clearInterval(cronometro);  // Detener el intervalo existente antes de configurar uno nuevo
          cronometro = setInterval(Cronometro, 1000);  // Configurar un nuevo intervalo
        }

        // Actualizar el estado de la acción
        estadoAccion = data.accion;
      })
      .catch(function (error) {
        console.error('Error en la solicitud AJAX', error);
      });
  }

  // Llamar a la función para actualizar el cronómetro cada cierto tiempo
  setInterval(actualizarCronometro, 2000);

  //   function obtenerBanners() {
  //   fetch('/datostv')
  //     .then(response => response.json())
  //     .then(data => {
  //       // Aquí puedes procesar los datos obtenidos de '/datostv'
  //     })
  //     .catch(error => console.error(error));
  // }

  // // Llama a la función obtenerBanners cada 3 segundos
  // setInterval(obtenerBanners, 3000);
</script>

<!--  -->
<!-- <script>
  console.log("Fuera del bucle");

  let bannerElement = null; 

  function obtenerBanners() {
    fetch('/datostv')
      .then(response => response.json())
      .then(data => {
        const bannersContainer = document.getElementById('banners-container');
        if (bannersContainer) {
          const nuevosBanners = data.banners;

          if (nuevosBanners.length > 0) {
            const banner = nuevosBanners[0];

            if (!bannerElement) {
              bannerElement = document.createElement('div');
              bannerElement.classList.add('banner-container');
              bannersContainer.appendChild(bannerElement);
            }
            
            bannerElement.innerHTML = banner.html; // Actualizar el HTML del banner actual
            console.log('HTML del banner:', banner.html);
            // Muestra banners-container
            bannersContainer.style.display = 'block';

            // Verifica si el banner es de tipo CRONÓMETRO
            if (banner.html.includes('id="cronometro"')) {
              // Banner de CRONÓMETRO, no aplicar la lógica de temporización
              return;
            }

            // Oculta banners-container después de 10 segundos para banners no CRONÓMETRO
            setTimeout(() => {
              bannersContainer.style.display = 'none';
              // Limpia el archivo temporal 'eventos_temporales.json'
              fetch('/limpiar-eventos-temporales')
                .then(response => response.json())
                .then(data => {
                  console.log('Archivo temporal limpiado:', data);
                })
                .catch(error => console.error(error));
            }, 10000);
          }
        } else {
          console.error('Elemento con ID "banners-container" no encontrado.');
        }
      })
      .catch(error => console.error(error));
  }

  // obtenerBanners();
  setInterval(obtenerBanners, 2000);
</script> -->



{% endblock %}